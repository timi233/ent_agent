# 城市大脑企业信息处理系统架构设计

## 1. 系统概述

城市大脑企业信息处理系统是一个智能信息处理平台，旨在通过结合本地数据库、联网搜索和大语言模型技术，为用户提供企业及其关联产业信息的结构化总结。系统能够自动提取用户输入中的企业名称，查询本地数据库，补充缺失信息，并最终生成结构化的信息摘要。

## 2. 系统架构图

```
+-------------------+     +------------------+     +------------------+
|   用户输入接口    | --> | 信息提取模块     | --> | 数据库查询模块   |
+-------------------+     +------------------+     +------------------+
                                                                  |
                                                                  v
+-------------------+     +------------------+     +------------------+
|   联网搜索模块    | <-- | 数据处理中心     | --> | 本地数据库       |
+-------------------+     +------------------+     +------------------+
        |                         |
        v                         v
+-------------------+     +------------------+
|   大语言模型      | <-- | 结果输出模块     |
+-------------------+     +------------------+
```

## 3. 核心组件设计

### 3.1 用户输入接口
- 接收用户输入的文本信息
- 支持多种输入方式（Web界面、API接口等）
- 对输入进行初步验证和预处理

### 3.2 信息提取模块
- 使用NLP技术或正则表达式从用户输入中提取企业名称
- 当无法提取企业名称时，向用户发送提示信息要求补充
- 输出标准化的企业名称供后续模块使用

### 3.3 数据库查询模块
- 基于提取的企业名称查询本地数据库（QD_customer表）
- 根据查询结果判断是否存在本地数据
- 若存在本地数据，则提取完整的企业相关信息

### 3.4 本地数据库
- 存储企业基本信息、行业信息、地区信息、产业大脑信息、链主企业信息等
- 包含以下核心表：
  - QD_customer（客户企业表）
  - QD_area（地区表）
  - QD_industry（行业表）
  - QD_industry_brain（产业大脑表）
  - QD_enterprise_chain_leader（链主企业表）
  - QD_brain_industry_rel（产业大脑行业关联表）

### 3.5 数据处理中心
- 系统的核心处理模块，负责协调各组件工作
- 根据数据库查询结果判断处理流程：
  - 若存在本地数据：进入本地数据处理分支
  - 若不存在本地数据：进入无本地数据处理流程

### 3.6 联网搜索模块
- 集成博查AI搜索API（https://api.bochaai.com/v1/web-search）
- 在信息缺失或无本地数据时，通过联网搜索补充企业信息
- 支持按时间范围、摘要生成等参数进行搜索配置
- 处理搜索结果并提取所需信息

### 3.7 大语言模型模块
- 集成DeepSeek API（https://api.deepseek.com）
- 使用deepseek-chat模型进行文本处理和结构化总结生成
- 将企业信息、产业信息、链主企业信息等整合成结构化摘要

### 3.8 结果输出模块
- 将处理结果以结构化格式输出给用户
- 支持多种输出格式（JSON、HTML、文本等）
- 在适当情况下更新本地数据库

## 4. 数据流设计

### 4.1 存在本地数据的处理流程
1. 用户输入信息 → 信息提取模块 → 提取企业名称
2. 企业名称 → 数据库查询模块 → 查询本地数据库
3. 查询到本地数据 → 数据处理中心 → 提取完整信息
4. 判断信息完整性：
   - 信息完整 → 大语言模型模块 → 生成结构化总结 → 结果输出模块 → 用户
   - 信息不完整 → 联网搜索模块 → 补充缺失信息 → 大语言模型模块 → 生成结构化总结 → 结果输出模块 → 用户
5. 更新本地数据库（如补充了新信息）

### 4.2 无本地数据的处理流程
1. 用户输入信息 → 信息提取模块 → 提取企业名称
2. 企业名称 → 数据库查询模块 → 查询本地数据库
3. 未查询到本地数据 → 数据处理中心 → 触发联网搜索
4. 联网搜索模块 → 搜索企业基础信息和关联产业信息
5. 搜索结果 → 大语言模型模块 → 生成结构化总结
6. 结果输出模块 → 输出结果给用户
7. 更新本地数据库 → 将新信息录入相关数据表

## 5. API集成设计

### 5.1 博查AI搜索API集成
- 接口地址：https://api.bochaai.com/v1/web-search
- 请求方式：POST
- 认证方式：Bearer Token（API KEY）
- 主要参数：
  - query：搜索关键词
  - summary：是否生成摘要
  - freshness：时间范围
  - count：返回结果数量
- 返回内容：网页、图片、视频搜索结果

### 5.2 DeepSeek LLM API集成
- 接口地址：https://api.deepseek.com
- 请求方式：POST（兼容OpenAI格式）
- 认证方式：API Key
- 主要参数：
  - model：使用"deepseek-chat"模型
  - messages：对话历史（包含system和user角色）
- 返回内容：大语言模型生成的文本

## 6. 数据库设计

### 6.1 核心数据表关系
```
QD_customer
  ├── industry_id → QD_industry.industry_id
  ├── brain_id → QD_industry_brain.brain_id
  └── chain_leader_id → QD_enterprise_chain_leader.enterprise_id

QD_industry_brain
  └── area_id → QD_area.area_id

QD_enterprise_chain_leader
  ├── area_id → QD_area.area_id
  └── industry_id → QD_industry.industry_id

QD_brain_industry_rel
  ├── brain_id → QD_industry_brain.brain_id
  └── industry_id → QD_industry.industry_id
```

## 7. 技术栈选择

- 后端语言：Python（适合数据处理和AI集成）
- Web框架：FastAPI（高性能，支持异步，易集成AI服务）
- 数据库：MySQL（与现有数据库兼容）
- AI服务集成：requests库（用于API调用）
- NLP处理：可选集成spaCy或正则表达式
- 部署：Docker容器化部署

## 8. 安全与性能考虑

### 8.1 安全性
- API密钥安全存储（使用环境变量或密钥管理服务）
- 数据库连接使用连接池
- 输入验证和过滤，防止SQL注入
- HTTPS通信加密

### 8.2 性能优化
- 数据库查询优化（合理使用索引）
- API调用结果缓存机制
- 异步处理联网搜索和LLM调用
- 批量处理能力支持

## 9. 扩展性设计

- 模块化设计，便于添加新的数据源
- 插件化架构，支持集成不同的搜索API和LLM
- 微服务架构支持，各组件可独立扩展
- 配置化管理，便于调整业务流程